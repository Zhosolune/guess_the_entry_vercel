import React, { useState, memo } from 'react';
import { Info, Sun, Moon } from 'lucide-react';
import { useTheme } from '../hooks/useTheme';

interface TopBarProps {
  /**
   * 顶部栏标题文案
   */
  title?: string;
  /**
   * 游戏进度（0-100），当提供该值时在顶部栏底部显示满屏宽进度条
   */
  progress?: number;
}

/**
 * 顶部栏组件（吸顶）
 * - 左侧：信息按钮，点击弹出游戏规则弹窗
 * - 中间：标题居中显示
 * - 右侧：主题切换按钮（明暗主题）
 */
export const TopBar: React.FC<TopBarProps> = memo(({ title = '词条猜测游戏', progress }) => {
  const { isDark, toggleTheme } = useTheme();
  const [showRules, setShowRules] = useState<boolean>(false);

  /**
   * 打开规则弹窗
   */
  const openRules = (): void => {
    setShowRules(true);
  };

  /**
   * 关闭规则弹窗
   */
  const closeRules = (): void => {
    setShowRules(false);
  };

  // 当有进度时，移除常规底部边框，由进度条承载视觉分隔
  const headerClass = `sticky top-0 z-50 bg-[var(--color-surface)] ${progress !== undefined ? '' : 'border-b border-[var(--color-border)]'}`;

  return (
    <header className={headerClass}>
      <div className="container mx-auto max-w-4xl px-3 h-15 grid grid-cols-3 items-center">
        {/* 左侧信息按钮 */}
        <div className="justify-self-start">
          <button
            onClick={openRules}
            className="inline-flex items-center p-2 text-[var(--color-text)] hover:text-[var(--color-primary)] focus:outline-none"
            aria-label="信息"
          >
            <svg className="w-6 h-6" viewBox="0 0 32 32" fill="currentColor">
              <path d="M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12a12 12 0 0 1-12 12z"></path>
              <circle cx="16" cy="23.5" r="1.5"></circle>
              <path d="M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z"></path>
            </svg>
          </button>
        </div>

        {/* 中间居中标题 */}
        <div className="justify-self-center flex items-center gap-1">
          <svg className="w-7 h-7" viewBox="0 0 32 32" fill="currentColor">
            <path d="M9.8 1.3L12.5 2.6Q12.5 2.6 12.6 2.6Q12.6 2.7 12.6 2.8L12.6 2.8Q12.6 2.9 12.5 3.1L12.5 3.1Q12.2 3.4 11.6 3.4L11.6 3.4Q11.5 3.4 11.3 3.4L11.3 3.4Q9.9 5.5 7.8 7.6L7.8 7.6Q10.2 11.9 10.3 18.7L10.3 18.7Q10.3 26.8 8.4 29.4L8.4 29.4Q7.5 30.7 5.1 30.7L5.1 30.7Q5.0 30.7 5.0 30.6Q4.9 30.6 4.9 30.5L4.9 30.5Q4.9 29.7 4.4 29.4L4.4 29.4Q3.5 28.9 2.0 28.7L2.0 28.7Q2.0 28.7 1.9 28.6Q1.9 28.5 1.9 28.4L1.9 28.4L1.9 27.9Q1.9 27.8 1.9 27.7Q2.0 27.6 2.0 27.6Q2.1 27.6 2.1 27.6L2.1 27.6Q4.6 27.9 5.9 27.9L5.9 27.9Q6.5 27.9 6.8 27.5L6.8 27.5Q8.0 25.8 8.0 18.8L8.0 18.8Q8.0 17.2 8.0 15.9L8.0 15.9Q6.9 17.6 5.2 19.3Q3.5 21.0 1.6 22.2L1.6 22.2Q1.5 22.3 1.5 22.3Q1.4 22.3 1.3 22.2L1.3 22.2L0.9 21.8Q0.9 21.7 0.9 21.7Q0.9 21.6 0.9 21.5L0.9 21.5Q2.9 19.6 4.7 17.1Q6.4 14.6 7.4 12.0L7.4 12.0Q7.1 10.5 6.4 8.9L6.4 8.9Q4.1 11.0 1.4 12.4L1.4 12.4Q1.4 12.5 1.3 12.5L1.3 12.5Q1.2 12.5 1.2 12.4L1.2 12.4L0.9 11.9Q0.8 11.9 0.8 11.8L0.8 11.8Q0.8 11.7 0.9 11.6L0.9 11.6Q3.3 9.8 5.6 7.2L5.6 7.2Q4.2 4.9 2.0 2.9L2.0 2.9Q1.9 2.8 1.9 2.8Q1.9 2.7 2.0 2.6L2.0 2.6L2.5 2.1Q2.6 2.1 2.6 2.1Q2.7 2.1 2.8 2.1L2.8 2.1Q5.1 3.8 6.7 5.9L6.7 5.9Q8.5 3.6 9.5 1.4L9.5 1.4Q9.6 1.3 9.7 1.3L9.7 1.3Q9.7 1.3 9.8 1.3L9.8 1.3ZM25.3 20.7L15.3 20.7L15.3 23.4L25.3 23.4L25.3 20.7ZM15.3 19.4L25.3 19.4L25.3 16.8L15.3 16.8L15.3 19.4ZM25.1 15.4L26.0 14.3Q26.0 14.2 26.1 14.2Q26.2 14.2 26.3 14.3L26.3 14.3Q28.7 16.1 28.8 16.1Q28.8 16.2 28.8 16.3L28.8 16.3Q28.8 16.4 28.7 16.5L28.7 16.5Q28.3 16.9 27.4 17.1L27.4 17.1L27.4 27.9Q27.4 29.3 26.8 29.9Q26.2 30.5 24.4 30.7L24.4 30.7Q24.4 30.7 24.4 30.7Q24.3 30.7 24.3 30.7Q24.2 30.6 24.2 30.5L24.2 30.5Q24.0 29.7 23.7 29.4L23.7 29.4Q23.0 29.0 21.4 28.8L21.4 28.8Q21.4 28.8 21.3 28.7Q21.2 28.7 21.2 28.6L21.2 28.6L21.2 28.1Q21.2 28.0 21.3 27.9Q21.4 27.8 21.4 27.8Q21.5 27.8 22.8 28.0Q24.2 28.1 24.7 28.1Q25.1 28.1 25.2 28.0Q25.3 27.9 25.3 27.6L25.3 27.6L25.3 24.8L15.3 24.8L15.3 29.9Q15.3 30.2 14.7 30.5Q14.2 30.8 13.7 30.8L13.7 30.8L13.4 30.8Q13.3 30.8 13.2 30.7Q13.2 30.6 13.2 30.5L13.2 30.5L13.2 14.7Q13.2 14.6 13.2 14.5Q13.3 14.5 13.3 14.5Q13.4 14.5 13.5 14.5L13.5 14.5L15.3 15.4L25.1 15.4ZM21.2 9.5L21.2 12.0L26.6 12.0Q27.9 10.3 28.0 10.3Q28 10.3 28.1 10.3Q28.2 10.3 28.2 10.3L28.2 10.3Q29.8 11.5 30.8 12.4L30.8 12.4Q30.9 12.5 30.9 12.6L30.9 12.6Q30.9 12.8 30.6 13.1Q30.4 13.3 29.8 13.3L29.8 13.3L10.9 13.3Q10.8 13.3 10.7 13.3Q10.7 13.2 10.7 13.2L10.7 13.2Q10.4 12.2 10.4 12.2Q10.4 12.1 10.5 12.0Q10.5 12.0 10.6 12.0L10.6 12.0L19.1 12.0L19.1 9.5L13.1 9.5Q13.0 9.5 13.0 9.5Q12.9 9.4 12.9 9.4L12.9 9.4Q12.6 8.4 12.6 8.4Q12.6 8.3 12.7 8.3Q12.8 8.2 12.9 8.2L12.9 8.2L19.1 8.2L19.1 5.9L11.6 5.9Q11.6 5.9 11.5 5.9Q11.5 5.8 11.4 5.8L11.4 5.8Q11.2 4.8 11.2 4.7Q11.2 4.6 11.2 4.6Q11.3 4.5 11.4 4.5L11.4 4.5L19.1 4.5L19.1 1.4Q19.1 1.3 19.2 1.3Q19.2 1.2 19.3 1.2Q19.3 1.2 22.1 1.5L22.1 1.5Q22.1 1.5 22.2 1.6Q22.3 1.6 22.3 1.7L22.3 1.7Q22.3 2.0 22 2.3Q21.7 2.6 21.2 2.7L21.2 2.7L21.2 4.5L26.0 4.5Q27.3 2.9 27.3 2.8Q27.3 2.8 27.4 2.8Q27.5 2.8 27.6 2.9L27.6 2.9Q29.2 4.1 30.1 5.0L30.1 5.0Q30.2 5.1 30.2 5.2L30.2 5.2Q30.2 5.4 30.0 5.7Q29.7 5.9 29.1 5.9L29.1 5.9L21.2 5.9L21.2 8.2L25.0 8.2Q26.2 6.7 26.2 6.7Q26.2 6.6 26.3 6.6Q26.4 6.6 26.5 6.7L26.5 6.7Q28.0 7.8 28.9 8.6L28.9 8.6Q29.0 8.7 29.0 8.8L29.0 8.8Q29.0 9.1 28.8 9.3Q28.5 9.5 28.0 9.5L28.0 9.5L21.2 9.5Z " />
          </svg>

          <svg className="w-7 h-7" viewBox="0 0 32 32" fill="currentColor">
            <path d="M18.0 10.3L18.0 10.3Q18.0 10.3 18.1 10.3Q18.1 10.4 18.1 10.5L18.1 10.5Q18.1 10.8 17.8 11.2Q17.5 11.5 17.0 11.6L17.0 11.6L17.0 30.0Q17.0 30.3 16.4 30.6Q15.9 30.8 15.4 30.8L15.4 30.8L15.0 30.8Q14.9 30.8 14.8 30.8Q14.8 30.7 14.8 30.6L14.8 30.6L14.8 10.1Q14.8 10.0 14.8 10.0Q14.9 9.9 15.0 9.9Q15.0 9.9 18.0 10.3ZM30.9 14.1L30.9 14.1Q30.9 14.1 31.0 14.2Q31.0 14.2 31.0 14.3Q31.0 14.3 30.9 14.8L30.9 14.8Q30.9 15.0 30.8 15.0L30.8 15.0Q29.6 15.3 29.3 16.4L29.3 16.4Q29.2 16.4 29.2 16.5Q29.2 16.5 29.1 16.5Q29.0 16.5 28.9 16.5L28.9 16.5Q24.7 13.9 21.4 10.6Q18.1 7.3 16.2 3.6L16.2 3.6Q14.0 7.2 10.0 10.9Q6.1 14.7 1.5 17.1L1.5 17.1Q1.5 17.1 1.4 17.1L1.4 17.1Q1.3 17.1 1.2 17.0L1.2 17.0L1.0 16.4Q1.0 16.4 1.0 16.3L1.0 16.3Q1.0 16.2 1.1 16.2L1.1 16.2Q5.3 13.4 9.2 9.2Q13.0 5.0 14.6 1.3L14.6 1.3Q14.7 1.2 14.8 1.2L14.8 1.2Q14.8 1.2 18.1 2.0L18.1 2.0Q18.1 2.1 18.2 2.1Q18.2 2.2 18.2 2.2L18.2 2.2Q18.2 2.4 18 2.7Q17.8 2.9 17.2 3.0L17.2 3.0Q19.5 6.3 23.1 9.2Q26.6 12.2 30.9 14.1Z " />
          </svg>

          <svg className="w-7 h-7" viewBox="0 0 32 32" fill="currentColor">
            <path d="M14.0 1.1L14.4 0.9Q14.5 0.8 14.5 0.8Q14.6 0.8 14.6 0.8L14.6 0.8Q17.7 1.8 18.4 3.6L18.4 3.6Q18.5 4.0 18.5 4.3L18.5 4.3Q18.5 5.0 18.0 5.3L18.0 5.3Q17.7 5.5 17.3 5.5Q17.0 5.5 16.5 5.2L16.5 5.2Q16.4 5.1 16.4 5.1L16.4 5.1Q16.2 4.3 15.6 3.3L15.6 3.3Q14.8 2.2 14.0 1.5L14.0 1.5Q14.0 1.4 14.0 1.3L14.0 1.3Q14.0 1.2 14.0 1.1L14.0 1.1ZM8.4 9.1L15.0 9.1L15.0 6.7L8.4 6.7L8.4 9.1ZM8.4 10.5L8.4 12.9L15.0 12.9L15.0 10.5L8.4 10.5ZM8.4 14.3L8.4 16.8L15.0 16.8L15.0 14.3L8.4 14.3ZM6.8 19.6L6.8 19.6L6.5 19.6Q6.4 19.6 6.4 19.6Q6.3 19.5 6.3 19.4L6.3 19.4L6.3 8.5Q4.1 11.0 1.7 12.5L1.7 12.5Q1.7 12.5 1.6 12.5Q1.5 12.5 1.4 12.5L1.4 12.5L1.0 12.0Q1.0 11.9 1.0 11.9Q1.0 11.8 1.0 11.7L1.0 11.7Q3.1 9.9 5.2 7.1Q7.3 4.2 8.7 1.2L8.7 1.2Q8.8 1.0 8.9 1.0L8.9 1.0Q8.9 1.0 9.0 1.1L9.0 1.1L11.6 2.3Q11.7 2.4 11.7 2.5L11.7 2.5Q11.7 2.7 11.5 2.9L11.5 2.9Q11.1 3.2 10.6 3.2L10.6 3.2Q10.4 3.2 10.3 3.2L10.3 3.2Q9.5 4.5 9.0 5.3L9.0 5.3L23.9 5.3Q25.2 3.7 25.2 3.6Q25.2 3.6 25.3 3.6Q25.4 3.6 25.5 3.6L25.5 3.6Q27.1 4.9 28.1 5.8L28.1 5.8Q28.1 5.9 28.1 5.9L28.1 5.9Q28.1 6.2 27.9 6.4Q27.6 6.7 27.1 6.7L27.1 6.7L17.2 6.7L17.2 9.1L23.2 9.1Q24.4 7.6 24.4 7.6Q24.4 7.6 24.5 7.6Q24.6 7.6 24.7 7.6L24.7 7.6Q26.1 8.7 27.0 9.6L27.0 9.6Q27.1 9.7 27.1 9.7L27.1 9.7Q27.1 10.0 26.8 10.2Q26.6 10.5 26.0 10.5L26.0 10.5L17.2 10.5L17.2 12.9L23.2 12.9L24.4 11.5Q24.4 11.4 24.5 11.4Q24.6 11.4 24.7 11.4L24.7 11.4Q26.1 12.5 27.1 13.4L27.1 13.4Q27.1 13.5 27.1 13.5L27.1 13.5Q27.1 13.8 26.9 14.0Q26.6 14.3 26.1 14.3L26.1 14.3L17.2 14.3L17.2 16.8L24.4 16.8Q25.6 15.2 25.7 15.1Q25.7 15.1 25.8 15.1Q25.9 15.1 25.9 15.1L25.9 15.1Q27.5 16.4 28.5 17.3L28.5 17.3Q28.6 17.4 28.6 17.4L28.6 17.4Q28.6 17.7 28.3 18.0Q28.1 18.2 27.5 18.2L27.5 18.2L8.4 18.2L8.4 18.8Q8.4 18.9 8.4 19.0Q8.3 19.1 8.1 19.2Q8 19.4 7.6 19.5Q7.2 19.6 6.8 19.6ZM26.2 20.9L27.6 19.2Q27.6 19.1 27.7 19.1Q27.8 19.1 27.8 19.1L27.8 19.1Q29.5 20.4 30.6 21.4L30.6 21.4Q30.7 21.5 30.7 21.6L30.7 21.6Q30.7 21.8 30.4 22.1Q30.1 22.3 29.6 22.3L29.6 22.3L18.8 22.3Q20.9 24 24.3 25.5Q27.7 26.9 31.1 27.7L31.1 27.7Q31.2 27.7 31.2 27.8Q31.3 27.8 31.3 27.9Q31.3 27.9 31.3 28.3L31.3 28.3Q31.3 28.4 31.2 28.4Q31.1 28.5 31.1 28.5L31.1 28.5Q30.5 28.5 30.0 29.0L30.0 29.0Q29.7 29.3 29.6 29.8L29.6 29.8Q29.6 29.8 29.6 29.9Q29.5 30.0 29.4 30.0Q29.4 30.0 29.3 30.0L29.3 30.0Q25.8 28.8 22.4 26.8L22.4 26.8Q19.1 24.8 17.1 22.3L17.1 22.3L17.1 30.0Q17.1 30.2 16.9 30.3Q16.8 30.5 16.4 30.7Q16.0 30.8 15.5 30.8L15.5 30.8L15.1 30.8Q15.0 30.8 15.0 30.8Q14.9 30.7 14.9 30.6L14.9 30.6L14.9 22.8Q10.0 27.6 1.4 30.3L1.4 30.3Q1.4 30.3 1.3 30.3L1.3 30.3Q1.2 30.3 1.2 30.1L1.2 30.1L0.9 29.6Q0.9 29.5 0.9 29.5Q0.9 29.4 0.9 29.4Q1.0 29.3 1.0 29.3L1.0 29.3Q7.8 26.6 12.2 22.3L12.2 22.3L1.7 22.3Q1.6 22.3 1.6 22.3Q1.5 22.2 1.5 22.2L1.5 22.2Q1.2 21.2 1.2 21.1Q1.2 21.1 1.3 21.0Q1.3 20.9 1.4 20.9L1.4 20.9L14.9 20.9L14.9 18.6Q14.9 18.5 15.0 18.4Q15.0 18.4 15.1 18.4Q15.1 18.4 18.0 18.7L18.0 18.7Q18.0 18.7 18.1 18.8Q18.1 18.8 18.1 18.9L18.1 18.9Q18.1 19.2 17.9 19.5Q17.6 19.8 17.1 19.9L17.1 19.9L17.1 20.9L26.2 20.9Z " />
          </svg>

          <svg className="w-7 h-7" viewBox="0 0 32 32" fill="currentColor">
            <path d="M22.3 1.9L22.7 1.5Q22.7 1.5 22.8 1.5Q22.8 1.5 22.8 1.5L22.8 1.5Q26.0 2.0 26.7 3.5L26.7 3.5Q26.8 3.8 26.8 4.2L26.8 4.2Q26.8 4.7 26.4 5.0L26.4 5.0Q26.1 5.2 25.8 5.2Q25.5 5.2 25.1 5.0L25.1 5.0Q25.0 4.9 25.0 4.9L25.0 4.9Q24.7 4.2 24.0 3.4Q23.2 2.7 22.4 2.2L22.4 2.2Q22.3 2.1 22.3 2.0Q22.3 2.0 22.3 1.9L22.3 1.9ZM21.1 12.1L26.0 12.1L26.0 10.0L21.1 10.0L21.1 12.1ZM26.0 13.5L21.1 13.5L21.1 15.6L26.0 15.6L26.0 13.5ZM19.0 13.5L14.2 13.5L14.2 15.6L19.0 15.6L19.0 13.5ZM14.2 12.1L19.0 12.1L19.0 10.0L14.2 10.0L14.2 12.1ZM10.4 6.4L10.1 5.5Q10.1 5.4 10.1 5.4Q10.1 5.3 10.2 5.2Q10.2 5.2 10.3 5.2L10.3 5.2L19.0 5.2L19.0 1.4Q19.0 1.3 19.0 1.3Q19.1 1.2 19.2 1.2Q19.2 1.2 21.9 1.5L21.9 1.5Q22.0 1.5 22.0 1.6Q22.1 1.6 22.1 1.7Q22.1 1.8 22.1 1.8L22.1 1.8Q21.9 2.5 21.1 2.8L21.1 2.8L21.1 5.2L26.8 5.2Q28.1 3.6 28.1 3.6Q28.1 3.6 28.2 3.6Q28.3 3.6 28.4 3.6L28.4 3.6Q29.9 4.8 30.8 5.7L30.8 5.7Q30.8 5.8 30.8 5.8L30.8 5.8Q30.8 6.1 30.6 6.3Q30.3 6.6 29.8 6.6L29.8 6.6L21.1 6.6L21.1 8.6L25.9 8.6L26.8 7.7Q26.8 7.6 26.9 7.6Q27.0 7.6 27.1 7.6L27.1 7.6Q29.2 9.3 29.2 9.3Q29.2 9.4 29.2 9.4L29.2 9.4Q29.2 9.6 29.1 9.8L29.1 9.8Q28.8 10.0 28.2 10.2L28.2 10.2L28.2 18.7Q28.2 19.0 27.6 19.3Q27.0 19.6 26.5 19.6L26.5 19.6L26.3 19.6Q26.2 19.6 26.1 19.5Q26.0 19.5 26.0 19.4L26.0 19.4L26.0 17.1L21.1 17.1L21.1 19.1Q21.1 19.4 20.6 19.7Q20.1 20 19.6 20L19.6 20L19.2 20Q19.1 20 19.0 19.9Q19.0 19.9 19.0 19.8L19.0 19.8L19.0 17.1L14.2 17.1L14.2 19.6Q14.2 19.8 14.1 19.9Q14.0 20.1 13.6 20.3Q13.2 20.4 12.6 20.4L12.6 20.4L12.4 20.4Q12.3 20.4 12.2 20.4Q12.1 20.3 12.1 20.2L12.1 20.2L12.1 8.0Q12.1 7.9 12.2 7.8Q12.3 7.7 12.3 7.7Q12.4 7.7 12.4 7.8L12.4 7.8L14.2 8.6L19.0 8.6L19.0 6.6L10.6 6.6Q10.5 6.6 10.4 6.5Q10.4 6.5 10.4 6.4L10.4 6.4ZM8 10.2L9.2 8.7Q9.3 8.6 9.4 8.6Q9.4 8.6 9.5 8.7L9.5 8.7Q10.9 9.9 11.8 10.8L11.8 10.8Q11.9 10.8 11.9 10.9L11.9 10.9Q11.9 11.2 11.7 11.4Q11.4 11.6 10.9 11.6L10.9 11.6L7.1 11.6L7.1 29.9Q7.1 30.2 6.6 30.5Q6.0 30.8 5.5 30.8L5.5 30.8L5.2 30.8Q5.1 30.8 5.0 30.8Q5.0 30.7 5.0 30.6L5.0 30.6L5.0 11.6L1.5 11.6Q1.4 11.6 1.4 11.6Q1.3 11.6 1.3 11.5L1.3 11.5Q1.0 10.5 1.0 10.4Q1.0 10.4 1.1 10.3Q1.2 10.2 1.2 10.2L1.2 10.2L5.0 10.2L5.0 1.4Q5.0 1.3 5.0 1.2Q5.1 1.2 5.1 1.2Q5.2 1.2 8.0 1.5L8.0 1.5Q8.1 1.5 8.2 1.6Q8.2 1.6 8.2 1.7Q8.2 1.8 8.2 1.8L8.2 1.8Q8.0 2.6 7.1 2.8L7.1 2.8L7.1 10.2L8 10.2ZM13.6 23.3L13.9 22.9Q14.0 22.9 14.0 22.9Q14.1 22.9 14.1 22.9L14.1 22.9Q17.6 23.9 18.5 25.9L18.5 25.9Q18.7 26.3 18.7 26.8L18.7 26.8Q18.7 27.3 18.2 27.6L18.2 27.6Q18.0 27.8 17.6 27.8Q17.3 27.8 16.8 27.6L16.8 27.6Q16.8 27.5 16.7 27.5L16.7 27.5Q16.4 26.2 14.9 24.7L14.9 24.7Q14.3 24.1 13.6 23.6L13.6 23.6Q13.5 23.5 13.5 23.4Q13.5 23.4 13.6 23.3L13.6 23.3ZM24.7 20L24.7 21.3L26.8 21.3Q28.0 19.7 28 19.7Q28.0 19.7 28.1 19.7Q28.2 19.7 28.3 19.7L28.3 19.7Q29.8 20.9 30.7 21.8L30.7 21.8Q30.8 21.9 30.8 22.0L30.8 22.0Q30.8 22.2 30.5 22.5Q30.3 22.7 29.8 22.7L29.8 22.7L24.7 22.7L24.7 27.8Q24.7 29.3 24.0 30.0Q23.4 30.6 21.6 30.8L21.6 30.8Q21.6 30.8 21.6 30.8Q21.5 30.8 21.4 30.7Q21.4 30.7 21.4 30.6L21.4 30.6Q21.2 29.8 20.8 29.5L20.8 29.5Q20.2 29.1 18.4 28.9L18.4 28.9Q18.3 28.9 18.2 28.8Q18.2 28.7 18.2 28.6L18.2 28.6L18.2 28.1Q18.2 28.0 18.2 28.0Q18.3 27.9 18.4 27.9Q18.4 27.9 20.0 28.0Q21.5 28.1 22.0 28.1Q22.4 28.1 22.5 28.0Q22.6 28.0 22.6 27.7L22.6 27.7L22.6 22.7L9.8 22.7Q9.7 22.7 9.6 22.7Q9.6 22.6 9.6 22.6L9.6 22.6Q9.3 21.6 9.3 21.5Q9.3 21.4 9.4 21.4Q9.4 21.3 9.5 21.3L9.5 21.3L22.6 21.3L22.6 18.7Q22.6 18.6 22.6 18.5Q22.7 18.4 22.7 18.4Q22.8 18.4 25.6 18.8L25.6 18.8Q25.7 18.8 25.7 18.8Q25.8 18.9 25.8 18.9Q25.8 19.0 25.8 19.0L25.8 19.0Q25.7 19.4 25.5 19.6Q25.2 19.9 24.7 20L24.7 20Z " />
          </svg>
        </div>

        {/* 右侧主题切换 */}
        <div className="justify-self-end">
          <button
            onClick={toggleTheme}
            className="inline-flex items-center p-2 text-[var(--color-text)] hover:text-[var(--color-primary)] focus:outline-none"
            aria-label={isDark ? '切换到明亮主题' : '切换到暗黑主题'}
            role="switch"
            aria-checked={isDark}
            aria-pressed={isDark}
            title={isDark ? '切换到明亮主题' : '切换到暗黑主题'}
          >
            {isDark ? (
              <svg className='w-6 h-6' viewBox="0 0 32 32" fill="currentColor">
                <path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path>
                <path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z"></path>
                <path d="M2 15.005h5v2H2z"></path>
                <path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z"></path>
                <path d="M15 25.005h2v5h-2z"></path>
                <path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z"></path>
                <path d="M25 15.005h5v2h-5z"></path>
                <path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z"></path>
                <path d="M15 2.005h2v5h-2z"></path>
              </svg>
            ) : (
                <svg className="w-6 h-6" viewBox="0 0 32 32" fill="currentColor">
                  <path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z"></path>
                </svg>
            )}
          </button>
        </div>
      </div>

      {/* 顶部栏底部满屏宽进度条 */}
      {typeof progress === 'number' && (
        <div className="w-full h-1 bg-[var(--color-border)]">
          <div
            className="progress-fill h-1"
            style={{ width: `${Math.max(0, Math.min(100, progress))}%` }}
          ></div>
        </div>
      )}

      {/* 游戏规则弹窗 */}
      {showRules && (
        <div className="fixed inset-0 z-[60] bg-black/40 flex items-center justify-center p-4" onClick={closeRules}>
          <div className="card-flat section max-w-lg w-full bg-[var(--color-surface)]" onClick={(e) => e.stopPropagation()}>
            <div className="flex items-center justify-between mb-4">
              <h2 className="text-xl font-semibold text-[var(--color-text)]">游戏规则</h2>
              <button 
                className="btn-flat"
                onClick={closeRules}>
                  <svg className="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" aria-hidden="true">
                    <path d="M18 6L6 18" />
                    <path d="M6 6l12 12" />
                  </svg>
                </button>
            </div>
            <div className="space-y-3 text-[var(--color-text-muted)]">
              <p>1、选择一个你感兴趣的领域，系统将随机生成一个词条</p>
              <p>2、输入单个汉字进行猜测，正确的字符会显示出来</p>
              <p>3、猜错的字符会被添加到“坟场”区域</p>
              <p>4、完全揭示词条内容即可获胜！</p>
            </div>
          </div>
        </div>
      )}
    </header>
  );
});

// 添加显示名称用于调试
TopBar.displayName = 'TopBar';

export default TopBar;